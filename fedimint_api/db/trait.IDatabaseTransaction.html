<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Fedimint requires that the database implementation implement Snapshot Isolation. Snapshot Isolation is a database isolation level that guarantees consistent reads from the time that the snapshot was created (at transaction creation time). Transactions with Snapshot Isolation level will only commit if there has been no write to the modified keys since the snapshot (i.e. write-write conflicts are prevented)."><meta name="keywords" content="rust, rustlang, rust-lang, IDatabaseTransaction"><title>IDatabaseTransaction in fedimint_api::db - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../fedimint_api/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../fedimint_api/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">IDatabaseTransaction</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.commit_tx">commit_tx</a></li><li><a href="#tymethod.raw_find_by_prefix">raw_find_by_prefix</a></li><li><a href="#tymethod.raw_get_bytes">raw_get_bytes</a></li><li><a href="#tymethod.raw_insert_bytes">raw_insert_bytes</a></li><li><a href="#tymethod.raw_remove_entry">raw_remove_entry</a></li><li><a href="#tymethod.rollback_tx_to_savepoint">rollback_tx_to_savepoint</a></li><li><a href="#tymethod.set_tx_savepoint">set_tx_savepoint</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In fedimint_api::db</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Trait <a href="../index.html">fedimint_api</a>::<wbr><a href="index.html">db</a>::<wbr><a class="trait" href="#">IDatabaseTransaction</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/fedimint_api/db/mod.rs.html#98-118">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust trait"><code>pub trait IDatabaseTransaction&lt;'a&gt;: 'a {
    fn <a href="#tymethod.raw_insert_bytes" class="fnname">raw_insert_bytes</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;&gt;&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.raw_get_bytes" class="fnname">raw_get_bytes</a>(&amp;self, key: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;&gt;&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.raw_remove_entry" class="fnname">raw_remove_entry</a>(&amp;mut self, key: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;&gt;&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.raw_find_by_prefix" class="fnname">raw_find_by_prefix</a>(&amp;self, key_prefix: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; <a class="type" href="type.PrefixIter.html" title="type fedimint_api::db::PrefixIter">PrefixIter</a>&lt;'_&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.commit_tx" class="fnname">commit_tx</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.rollback_tx_to_savepoint" class="fnname">rollback_tx_to_savepoint</a>(&amp;mut self);
<span class="item-spacer"></span>    fn <a href="#tymethod.set_tx_savepoint" class="fnname">set_tx_savepoint</a>(&amp;mut self);
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Fedimint requires that the database implementation implement Snapshot Isolation.
Snapshot Isolation is a database isolation level that guarantees consistent reads
from the time that the snapshot was created (at transaction creation time). Transactions
with Snapshot Isolation level will only commit if there has been no write to the modified
keys since the snapshot (i.e. write-write conflicts are prevented).</p>
<p>Specifically, Fedimint expects the database implementation to prevent the following
anamolies:</p>
<p>Non-Readable Write: TX1 writes (K1, V1) at time t but cannot read (K1, V1) at time (t + i)</p>
<p>Dirty Read: TX1 is able to read TX2’s uncommitted writes.</p>
<p>Non-Repeatable Read: TX1 reads (K1, V1) at time t and retrieves (K1, V2) at time (t + i) where
V1 != V2.</p>
<p>Phantom Record: TX1 retrieves X number of records for a prefix at time t and retrieves Y number
of records for the same prefix at time (t + i).</p>
<p>Lost Writes: TX1 writes (K1, V1) at the same time as TX2 writes (K1, V2). V2 overwrites V1 as the
value for K1 (write-write conflict).</p>
<p>Table for anamolies that are prevented in each DB implementation:
| Non-Readable Write | Dirty Read | Non-Repeatable Read | Phantom Record | Lost Writes
MemoryDB |          X         |     X      |          X          |       X        |
SledDB   |          X         |     X      |                     |                |
RocksDB  |          X         |     X      |          X          |       X        |      X</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><section id="tymethod.raw_insert_bytes" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#99">source</a><h4 class="code-header">fn <a href="#tymethod.raw_insert_bytes" class="fnname">raw_insert_bytes</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self,<br>&nbsp;&nbsp;&nbsp;&nbsp;key: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>],<br>&nbsp;&nbsp;&nbsp;&nbsp;value: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;<br>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;&gt;&gt;</h4></section><section id="tymethod.raw_get_bytes" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#101">source</a><h4 class="code-header">fn <a href="#tymethod.raw_get_bytes" class="fnname">raw_get_bytes</a>(&amp;self, key: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;&gt;&gt;</h4></section><section id="tymethod.raw_remove_entry" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#103">source</a><h4 class="code-header">fn <a href="#tymethod.raw_remove_entry" class="fnname">raw_remove_entry</a>(&amp;mut self, key: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;&gt;&gt;</h4></section><section id="tymethod.raw_find_by_prefix" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#105">source</a><h4 class="code-header">fn <a href="#tymethod.raw_find_by_prefix" class="fnname">raw_find_by_prefix</a>(&amp;self, key_prefix: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; <a class="type" href="type.PrefixIter.html" title="type fedimint_api::db::PrefixIter">PrefixIter</a>&lt;'_&gt;</h4></section><section id="tymethod.commit_tx" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#107">source</a><h4 class="code-header">fn <a href="#tymethod.commit_tx" class="fnname">commit_tx</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.65/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section><section id="tymethod.rollback_tx_to_savepoint" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#109">source</a><h4 class="code-header">fn <a href="#tymethod.rollback_tx_to_savepoint" class="fnname">rollback_tx_to_savepoint</a>(&amp;mut self)</h4></section><details class="rustdoc-toggle method-toggle" open><summary><section id="tymethod.set_tx_savepoint" class="method has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mod.rs.html#117">source</a><h4 class="code-header">fn <a href="#tymethod.set_tx_savepoint" class="fnname">set_tx_savepoint</a>(&amp;mut self)</h4></section></summary><div class="docblock"><p>Create a savepoint during the transaction that can be rolled back to using
rollback_tx_to_savepoint. Rolling back to the savepoint will atomically remove the writes
that were applied since the savepoint was created.</p>
<p>Warning: Avoid using this in fedimint client code as not all database transaction
implementations will support setting a savepoint during a transaction.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div id="implementors-list"><section id="impl-IDatabaseTransaction%3C%27a%3E-for-MemTransaction%3C%27a%3E" class="impl has-srclink"><a class="srclink rightside" href="../../src/fedimint_api/db/mem_impl.rs.html#64-138">source</a><a href="#impl-IDatabaseTransaction%3C%27a%3E-for-MemTransaction%3C%27a%3E" class="anchor"></a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.IDatabaseTransaction.html" title="trait fedimint_api::db::IDatabaseTransaction">IDatabaseTransaction</a>&lt;'a&gt; for <a class="struct" href="mem_impl/struct.MemTransaction.html" title="struct fedimint_api::db::mem_impl::MemTransaction">MemTransaction</a>&lt;'a&gt;</h3></section></div><script src="../../implementors/fedimint_api/db/trait.IDatabaseTransaction.js" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="fedimint_api" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.67.0-nightly (11ebe6512 2022-11-01)" ></div></body></html>