<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Core Fedimint database traits and types"><title>fedimint_core::db - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="fedimint_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0 (cc66ad468 2023-10-03)" data-channel="1.73.0" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-1596385f77d47ef2.css" data-theme-dark-css="dark-0a43001d3fc2282c.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-1596385f77d47ef2.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-0a43001d3fc2282c.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../fedimint_core/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../fedimint_core/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module db</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press â€˜Sâ€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">fedimint_core</a>::<wbr><a class="mod" href="#">db</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/fedimint_core/db/mod.rs.html#1-2785">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Core Fedimint database traits and types</p>
<h2 id="isolation-of-database-transactions"><a href="#isolation-of-database-transactions">Isolation of database transactions</a></h2>
<p>Fedimint requires that the database implementation implement Snapshot
Isolation. Snapshot Isolation is a database isolation level that guarantees
consistent reads from the time that the snapshot was created (at transaction
creation time). Transactions with Snapshot Isolation level will only commit
if there has been no write to the modified keys since the snapshot (i.e.
write-write conflicts are prevented).</p>
<p>Specifically, Fedimint expects the database implementation to prevent the
following anomalies:</p>
<p>Non-Readable Write: TX1 writes (K1, V1) at time t but cannot read (K1, V1)
at time (t + i)</p>
<p>Dirty Read: TX1 is able to read TX2â€™s uncommitted writes.</p>
<p>Non-Repeatable Read: TX1 reads (K1, V1) at time t and retrieves (K1, V2) at
time (t + i) where V1 != V2.</p>
<p>Phantom Record: TX1 retrieves X number of records for a prefix at time t and
retrieves Y number of records for the same prefix at time (t + i).</p>
<p>Lost Writes: TX1 writes (K1, V1) at the same time as TX2 writes (K1, V2). V2
overwrites V1 as the value for K1 (write-write conflict).</p>
<p>| Type     | Non-Readable Write | Dirty Read | Non-Repeatable Read | Phantom
Record | Lost Writes | | â€“â€“â€“â€“ | â€”â€”â€”â€”â€”â€” | â€“â€“â€“â€“â€“ |
â€”â€”â€”â€”â€”â€“â€“ | â€“â€“â€“â€“â€“â€“â€“ | â€”â€”â€”â€“ | | MemoryDB | Prevented
| Prevented  | Prevented           | Prevented      | Possible    |
| RocksDB  | Prevented          | Prevented  | Prevented           |
Prevented      | Prevented   | | Sqlite   | Prevented          | Prevented
| Prevented           | Prevented      | Prevented   |</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="mem_impl/index.html" title="mod fedimint_core::db::mem_impl">mem_impl</a></div></li><li><div class="item-name"><a class="mod" href="notifications/index.html" title="mod fedimint_core::db::notifications">notifications</a></div></li><li><div class="item-name"><a class="mod" href="test_utils/index.html" title="mod fedimint_core::db::test_utils">test_utils</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BaseDatabase.html" title="struct fedimint_core::db::BaseDatabase">BaseDatabase</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Base functionality around <a href="trait.IRawDatabase.html" title="trait fedimint_core::db::IRawDatabase"><code>IRawDatabase</code></a> to make it a <a href="trait.IDatabase.html" title="trait fedimint_core::db::IDatabase"><code>IDatabase</code></a></div></li><li><div class="item-name"><a class="struct" href="struct.BaseDatabaseTransaction.html" title="struct fedimint_core::db::BaseDatabaseTransaction">BaseDatabaseTransaction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Struct that implements <code>IRawDatabaseTransaction</code> and can be wrapped
easier in other structs since it does not consumed <code>self</code> by move.</div></li><li><div class="item-name"><a class="struct" href="struct.CommitTracker.html" title="struct fedimint_core::db::CommitTracker">CommitTracker</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A helper for tracking and logging on <code>Drop</code> any instances of uncommitted
writes</div></li><li><div class="item-name"><a class="struct" href="struct.Committable.html" title="struct fedimint_core::db::Committable">Committable</a></div><div class="desc docblock-short">Session type for <a href="struct.DatabaseTransaction.html" title="struct fedimint_core::db::DatabaseTransaction"><code>DatabaseTransaction</code></a> that is allowed to commit</div></li><li><div class="item-name"><a class="struct" href="struct.Database.html" title="struct fedimint_core::db::Database">Database</a></div><div class="desc docblock-short">A public-facing newtype over <code>IDatabase</code></div></li><li><div class="item-name"><a class="struct" href="struct.DatabaseTransaction.html" title="struct fedimint_core::db::DatabaseTransaction">DatabaseTransaction</a></div><div class="desc docblock-short">A high level database transaction handle</div></li><li><div class="item-name"><a class="struct" href="struct.DatabaseVersion.html" title="struct fedimint_core::db::DatabaseVersion">DatabaseVersion</a></div></li><li><div class="item-name"><a class="struct" href="struct.DatabaseVersionKey.html" title="struct fedimint_core::db::DatabaseVersionKey">DatabaseVersionKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.DbKeyPrefixIter.html" title="struct fedimint_core::db::DbKeyPrefixIter">DbKeyPrefixIter</a></div><div class="desc docblock-short">An iterator over the variants of <a href="struct.DbKeyPrefixIter.html" title="struct fedimint_core::db::DbKeyPrefixIter">Self</a></div></li><li><div class="item-name"><a class="struct" href="struct.NonCommittable.html" title="struct fedimint_core::db::NonCommittable">NonCommittable</a></div><div class="desc docblock-short">Session type for a <a href="struct.DatabaseTransaction.html" title="struct fedimint_core::db::DatabaseTransaction"><code>DatabaseTransaction</code></a> that is not allowed to commit</div></li><li><div class="item-name"><a class="struct" href="struct.PrefixDatabase.html" title="struct fedimint_core::db::PrefixDatabase">PrefixDatabase</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A database that wraps an <code>inner</code> one and adds a prefix to all operations,
effectively creating an isolated partition.</div></li><li><div class="item-name"><a class="struct" href="struct.PrefixDatabaseTransaction.html" title="struct fedimint_core::db::PrefixDatabaseTransaction">PrefixDatabaseTransaction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A database transactions that wraps an <code>inner</code> one and adds a prefix to all
operations, effectively creating an isolated partition.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.AutocommitError.html" title="enum fedimint_core::db::AutocommitError">AutocommitError</a></div><div class="desc docblock-short">Error returned when the autocommit function fails</div></li><li><div class="item-name"><a class="enum" href="enum.DbKeyPrefix.html" title="enum fedimint_core::db::DbKeyPrefix">DbKeyPrefix</a></div></li><li><div class="item-name"><a class="enum" href="enum.DecodingError.html" title="enum fedimint_core::db::DecodingError">DecodingError</a></div></li><li><div class="item-name"><a class="enum" href="enum.MaybeRef.html" title="enum fedimint_core::db::MaybeRef">MaybeRef</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="enum" href="enum.TestDbKeyPrefix.html" title="enum fedimint_core::db::TestDbKeyPrefix">TestDbKeyPrefix</a></div></li></ul><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.MODULE_GLOBAL_PREFIX.html" title="constant fedimint_core::db::MODULE_GLOBAL_PREFIX">MODULE_GLOBAL_PREFIX</a></div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.DatabaseKey.html" title="trait fedimint_core::db::DatabaseKey">DatabaseKey</a></div><div class="desc docblock-short"><code>DatabaseKey</code> that represents the lookup structure for retrieving key/value
pairs from the database.</div></li><li><div class="item-name"><a class="trait" href="trait.DatabaseKeyPrefix.html" title="trait fedimint_core::db::DatabaseKeyPrefix">DatabaseKeyPrefix</a></div></li><li><div class="item-name"><a class="trait" href="trait.DatabaseKeyWithNotify.html" title="trait fedimint_core::db::DatabaseKeyWithNotify">DatabaseKeyWithNotify</a></div><div class="desc docblock-short">Marker trait for <code>DatabaseKey</code>s where <code>NOTIFY</code> is true</div></li><li><div class="item-name"><a class="trait" href="trait.DatabaseLookup.html" title="trait fedimint_core::db::DatabaseLookup">DatabaseLookup</a></div><div class="desc docblock-short">A key that can be used to query one or more <code>DatabaseRecord</code>
Extends <code>DatabaseKeyPrefix</code> to prepend the keyâ€™s prefix.</div></li><li><div class="item-name"><a class="trait" href="trait.DatabaseRecord.html" title="trait fedimint_core::db::DatabaseRecord">DatabaseRecord</a></div><div class="desc docblock-short">A key + value pair in the database with a unique prefix
Extends <code>DatabaseKeyPrefix</code> to prepend the keyâ€™s prefix.</div></li><li><div class="item-name"><a class="trait" href="trait.DatabaseValue.html" title="trait fedimint_core::db::DatabaseValue">DatabaseValue</a></div><div class="desc docblock-short"><code>DatabaseValue</code> that represents the value structure of database records.</div></li><li><div class="item-name"><a class="trait" href="trait.IDatabase.html" title="trait fedimint_core::db::IDatabase">IDatabase</a></div><div class="desc docblock-short">A database that on top of a raw database operation, implements
key notification system.</div></li><li><div class="item-name"><a class="trait" href="trait.IDatabaseTransaction.html" title="trait fedimint_core::db::IDatabaseTransaction">IDatabaseTransaction</a></div><div class="desc docblock-short">Fedimint database transaction</div></li><li><div class="item-name"><a class="trait" href="trait.IDatabaseTransactionOps.html" title="trait fedimint_core::db::IDatabaseTransactionOps">IDatabaseTransactionOps</a></div><div class="desc docblock-short">Additional operations (only some) database transactions expose, on top of
<a href="trait.IDatabaseTransactionOpsCore.html" title="trait fedimint_core::db::IDatabaseTransactionOpsCore"><code>IDatabaseTransactionOpsCore</code></a></div></li><li><div class="item-name"><a class="trait" href="trait.IDatabaseTransactionOpsCore.html" title="trait fedimint_core::db::IDatabaseTransactionOpsCore">IDatabaseTransactionOpsCore</a></div><div class="desc docblock-short">Core raw a operations database transactions supports</div></li><li><div class="item-name"><a class="trait" href="trait.IDatabaseTransactionOpsCoreTyped.html" title="trait fedimint_core::db::IDatabaseTransactionOpsCoreTyped">IDatabaseTransactionOpsCoreTyped</a></div><div class="desc docblock-short">Like <a href="trait.IDatabaseTransactionOpsCore.html" title="trait fedimint_core::db::IDatabaseTransactionOpsCore"><code>IDatabaseTransactionOpsCore</code></a>, but typed</div></li><li><div class="item-name"><a class="trait" href="trait.IRawDatabase.html" title="trait fedimint_core::db::IRawDatabase">IRawDatabase</a></div><div class="desc docblock-short">Raw database implementation</div></li><li><div class="item-name"><a class="trait" href="trait.IRawDatabaseExt.html" title="trait fedimint_core::db::IRawDatabaseExt">IRawDatabaseExt</a></div><div class="desc docblock-short">An extension trait with convenience operations on <a href="trait.IRawDatabase.html" title="trait fedimint_core::db::IRawDatabase"><code>IRawDatabase</code></a></div></li><li><div class="item-name"><a class="trait" href="trait.IRawDatabaseTransaction.html" title="trait fedimint_core::db::IRawDatabaseTransaction">IRawDatabaseTransaction</a></div><div class="desc docblock-short">Raw database transaction (e.g. rocksdb implementation)</div></li><li><div class="item-name"><a class="trait" href="trait.WithDecoders.html" title="trait fedimint_core::db::WithDecoders">WithDecoders</a></div><div class="desc docblock-short">A database type that has decoders, which allows it to implement
<a href="trait.IDatabaseTransactionOpsCoreTyped.html" title="trait fedimint_core::db::IDatabaseTransactionOpsCoreTyped"><code>IDatabaseTransactionOpsCoreTyped</code></a></div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.apply_migrations.html" title="fn fedimint_core::db::apply_migrations">apply_migrations</a></div><div class="desc docblock-short"><code>apply_migrations</code> iterates from the on disk database version for the module
up to <code>target_db_version</code> and executes all of the migrations that exist in
the <code>MigrationMap</code>. Each migration in <code>MigrationMap</code> updates the database to
have the correct on-disk structures that the code is expecting. The entire
migration process is atomic (i.e migration from 0-&gt;1 and 1-&gt;2 happen
atomically). This function is called before the module is initialized and as
long as the correct migrations are supplied in <code>MigrationMap</code>, the module
will be able to read and write from the database successfully.</div></li><li><div class="item-name"><a class="fn" href="fn.decode_value.html" title="fn fedimint_core::db::decode_value">decode_value</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.expect_write_conflict.html" title="fn fedimint_core::db::expect_write_conflict">expect_write_conflict</a></div></li><li><div class="item-name"><a class="fn" href="fn.find_by_prefix_sorted_descending.html" title="fn fedimint_core::db::find_by_prefix_sorted_descending">find_by_prefix_sorted_descending</a></div></li><li><div class="item-name"><a class="fn" href="fn.future_returns_shortly.html" title="fn fedimint_core::db::future_returns_shortly">future_returns_shortly</a></div></li><li><div class="item-name"><a class="fn" href="fn.module_instance_id_to_byte_prefix.html" title="fn fedimint_core::db::module_instance_id_to_byte_prefix">module_instance_id_to_byte_prefix</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.verify_commit.html" title="fn fedimint_core::db::verify_commit">verify_commit</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_find_by_prefix.html" title="fn fedimint_core::db::verify_find_by_prefix">verify_find_by_prefix</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_insert_elements.html" title="fn fedimint_core::db::verify_insert_elements">verify_insert_elements</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_module_db.html" title="fn fedimint_core::db::verify_module_db">verify_module_db</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_module_prefix.html" title="fn fedimint_core::db::verify_module_prefix">verify_module_prefix</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_phantom_entry.html" title="fn fedimint_core::db::verify_phantom_entry">verify_phantom_entry</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_prevent_dirty_reads.html" title="fn fedimint_core::db::verify_prevent_dirty_reads">verify_prevent_dirty_reads</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_prevent_nonrepeatable_reads.html" title="fn fedimint_core::db::verify_prevent_nonrepeatable_reads">verify_prevent_nonrepeatable_reads</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_read_own_writes.html" title="fn fedimint_core::db::verify_read_own_writes">verify_read_own_writes</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_remove_by_prefix.html" title="fn fedimint_core::db::verify_remove_by_prefix">verify_remove_by_prefix</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_remove_existing.html" title="fn fedimint_core::db::verify_remove_existing">verify_remove_existing</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_remove_nonexisting.html" title="fn fedimint_core::db::verify_remove_nonexisting">verify_remove_nonexisting</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_rollback_to_savepoint.html" title="fn fedimint_core::db::verify_rollback_to_savepoint">verify_rollback_to_savepoint</a></div></li><li><div class="item-name"><a class="fn" href="fn.verify_string_prefix.html" title="fn fedimint_core::db::verify_string_prefix">verify_string_prefix</a></div></li></ul><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.MigrationMap.html" title="type fedimint_core::db::MigrationMap">MigrationMap</a></div><div class="desc docblock-short">MigrationMap is a BTreeMap that maps DatabaseVersions to async functions.
These functions are expected to â€œmigrateâ€ the database from the keyed
DatabaseVersion to DatabaseVersion + 1.</div></li><li><div class="item-name"><a class="type" href="type.PhantomBound.html" title="type fedimint_core::db::PhantomBound">PhantomBound</a></div><div class="desc docblock-short">Just ignore this type, itâ€™s only there to make compiler happy</div></li><li><div class="item-name"><a class="type" href="type.PrefixStream.html" title="type fedimint_core::db::PrefixStream">PrefixStream</a></div></li></ul></section></div></main></body></html>