<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Database keys used by the client"><title>fedimint_client::db - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-916cea96.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="fedimint_client" data-themes="" data-resource-suffix="" data-rustdoc-version="1.87.0-nightly (1aeb99d24 2025-03-19)" data-channel="nightly" data-search-js="search-e7298875.js" data-settings-js="settings-d72f25bb.js" ><script src="../../static.files/storage-d8ac8691.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-fb8c74a8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../fedimint_client/index.html">fedimint_<wbr>client</a><span class="version">0.8.0-alpha</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module db</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate fedimint_<wbr>client</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">fedimint_client</a></div><h1>Module <span>db</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/fedimint_client/db.rs.html#1-954">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Database keys used by the client</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">ยง</a></h2><dl class="item-table"><dt><a class="struct" href="struct.ApiSecretKey.html" title="struct fedimint_client::db::ApiSecretKey">ApiSecret<wbr>Key</a></dt><dt><a class="struct" href="struct.ApiSecretKeyPrefix.html" title="struct fedimint_client::db::ApiSecretKeyPrefix">ApiSecret<wbr>KeyPrefix</a></dt><dt><a class="struct" href="struct.CachedApiVersionSet.html" title="struct fedimint_client::db::CachedApiVersionSet">Cached<wbr>ApiVersion<wbr>Set</a></dt><dt><a class="struct" href="struct.CachedApiVersionSetKey.html" title="struct fedimint_client::db::CachedApiVersionSetKey">Cached<wbr>ApiVersion<wbr>SetKey</a></dt><dt><a class="struct" href="struct.ChronologicalOperationLogKey.html" title="struct fedimint_client::db::ChronologicalOperationLogKey">Chronological<wbr>Operation<wbr>LogKey</a></dt><dd>Key used to lookup operation log entries in chronological order</dd><dt><a class="struct" href="struct.ChronologicalOperationLogKeyPrefix.html" title="struct fedimint_client::db::ChronologicalOperationLogKeyPrefix">Chronological<wbr>Operation<wbr>LogKey<wbr>Prefix</a></dt><dt><a class="struct" href="struct.ClientConfigKey.html" title="struct fedimint_client::db::ClientConfigKey">Client<wbr>Config<wbr>Key</a></dt><dt><a class="struct" href="struct.ClientConfigKeyPrefixV0.html" title="struct fedimint_client::db::ClientConfigKeyPrefixV0">Client<wbr>Config<wbr>KeyPrefix<wbr>V0</a></dt><dt><a class="struct" href="struct.ClientConfigKeyV0.html" title="struct fedimint_client::db::ClientConfigKeyV0">Client<wbr>Config<wbr>KeyV0</a></dt><dt><a class="struct" href="struct.ClientInitStateKey.html" title="struct fedimint_client::db::ClientInitStateKey">Client<wbr>Init<wbr>State<wbr>Key</a></dt><dd>Does the client modules need to run recovery before being usable?</dd><dt><a class="struct" href="struct.ClientInitStatePrefix.html" title="struct fedimint_client::db::ClientInitStatePrefix">Client<wbr>Init<wbr>State<wbr>Prefix</a></dt><dt><a class="struct" href="struct.ClientMetadataKey.html" title="struct fedimint_client::db::ClientMetadataKey">Client<wbr>Metadata<wbr>Key</a></dt><dd>Client metadata that will be stored/restored on backup&amp;recovery</dd><dt><a class="struct" href="struct.ClientMetadataPrefix.html" title="struct fedimint_client::db::ClientMetadataPrefix">Client<wbr>Metadata<wbr>Prefix</a></dt><dt><a class="struct" href="struct.ClientModuleRecovery.html" title="struct fedimint_client::db::ClientModuleRecovery">Client<wbr>Module<wbr>Recovery</a></dt><dt><a class="struct" href="struct.ClientModuleRecoveryPrefix.html" title="struct fedimint_client::db::ClientModuleRecoveryPrefix">Client<wbr>Module<wbr>Recovery<wbr>Prefix</a></dt><dt><a class="struct" href="struct.ClientModuleRecoveryState.html" title="struct fedimint_client::db::ClientModuleRecoveryState">Client<wbr>Module<wbr>Recovery<wbr>State</a></dt><dt><a class="struct" href="struct.ClientPreRootSecretHashKey.html" title="struct fedimint_client::db::ClientPreRootSecretHashKey">Client<wbr>PreRoot<wbr>Secret<wbr>Hash<wbr>Key</a></dt><dt><a class="struct" href="struct.ClientRecoverySnapshot.html" title="struct fedimint_client::db::ClientRecoverySnapshot">Client<wbr>Recovery<wbr>Snapshot</a></dt><dt><a class="struct" href="struct.ClientRecoverySnapshotPrefix.html" title="struct fedimint_client::db::ClientRecoverySnapshotPrefix">Client<wbr>Recovery<wbr>Snapshot<wbr>Prefix</a></dt><dt><a class="struct" href="struct.DbKeyPrefixIter.html" title="struct fedimint_client::db::DbKeyPrefixIter">DbKey<wbr>Prefix<wbr>Iter</a></dt><dd>An iterator over the variants of <a href="enum.DbKeyPrefix.html" title="enum fedimint_client::db::DbKeyPrefix">DbKeyPrefix</a></dd><dt><a class="struct" href="struct.EncodedClientSecretKey.html" title="struct fedimint_client::db::EncodedClientSecretKey">Encoded<wbr>Client<wbr>Secret<wbr>Key</a></dt><dt><a class="struct" href="struct.EncodedClientSecretKeyPrefix.html" title="struct fedimint_client::db::EncodedClientSecretKeyPrefix">Encoded<wbr>Client<wbr>Secret<wbr>KeyPrefix</a></dt><dt><a class="struct" href="struct.LastBackupKey.html" title="struct fedimint_client::db::LastBackupKey">Last<wbr>Backup<wbr>Key</a></dt><dd>Last valid backup the client attempted to make</dd><dt><a class="struct" href="struct.MetaFieldKey.html" title="struct fedimint_client::db::MetaFieldKey">Meta<wbr>Field<wbr>Key</a></dt><dt><a class="struct" href="struct.MetaFieldPrefix.html" title="struct fedimint_client::db::MetaFieldPrefix">Meta<wbr>Field<wbr>Prefix</a></dt><dt><a class="struct" href="struct.MetaFieldValue.html" title="struct fedimint_client::db::MetaFieldValue">Meta<wbr>Field<wbr>Value</a></dt><dt><a class="struct" href="struct.MetaServiceInfo.html" title="struct fedimint_client::db::MetaServiceInfo">Meta<wbr>Service<wbr>Info</a></dt><dt><a class="struct" href="struct.MetaServiceInfoKey.html" title="struct fedimint_client::db::MetaServiceInfoKey">Meta<wbr>Service<wbr>Info<wbr>Key</a></dt><dt><a class="struct" href="struct.OperationLogEntryV0.html" title="struct fedimint_client::db::OperationLogEntryV0">Operation<wbr>LogEntry<wbr>V0</a></dt><dd>V0 version of operation log entry for migration purposes</dd><dt><a class="struct" href="struct.OperationLogKey.html" title="struct fedimint_client::db::OperationLogKey">Operation<wbr>LogKey</a></dt><dt><a class="struct" href="struct.OperationLogKeyPrefix.html" title="struct fedimint_client::db::OperationLogKeyPrefix">Operation<wbr>LogKey<wbr>Prefix</a></dt><dt><a class="struct" href="struct.OperationLogKeyPrefixV0.html" title="struct fedimint_client::db::OperationLogKeyPrefixV0">Operation<wbr>LogKey<wbr>Prefix<wbr>V0</a></dt><dt><a class="struct" href="struct.OperationLogKeyV0.html" title="struct fedimint_client::db::OperationLogKeyV0">Operation<wbr>LogKey<wbr>V0</a></dt><dt><a class="struct" href="struct.PeerLastApiVersionsSummary.html" title="struct fedimint_client::db::PeerLastApiVersionsSummary">Peer<wbr>Last<wbr>ApiVersions<wbr>Summary</a></dt><dt><a class="struct" href="struct.PeerLastApiVersionsSummaryKey.html" title="struct fedimint_client::db::PeerLastApiVersionsSummaryKey">Peer<wbr>Last<wbr>ApiVersions<wbr>Summary<wbr>Key</a></dt></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">ยง</a></h2><dl class="item-table"><dt><a class="enum" href="enum.DbKeyPrefix.html" title="enum fedimint_client::db::DbKeyPrefix">DbKey<wbr>Prefix</a></dt><dt><a class="enum" href="enum.InitMode.html" title="enum fedimint_client::db::InitMode">Init<wbr>Mode</a></dt><dd>Client initialization mode</dd><dt><a class="enum" href="enum.InitModeComplete.html" title="enum fedimint_client::db::InitModeComplete">Init<wbr>Mode<wbr>Complete</a></dt><dd>Like <code>InitMode</code>, but without no longer required data.</dd><dt><a class="enum" href="enum.InitState.html" title="enum fedimint_client::db::InitState">Init<wbr>State</a></dt><dd>The state of the client initialization</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">ยง</a></h2><dl class="item-table"><dt><a class="fn" href="fn.apply_migrations_client_module.html" title="fn fedimint_client::db::apply_migrations_client_module">apply_<wbr>migrations_<wbr>client_<wbr>module</a></dt><dd><code>apply_migrations_client</code> iterates from the on disk database version for the
client module up to <code>target_db_version</code> and executes all of the migrations
that exist in the migrations map, including state machine migrations.
Each migration in the migrations map updates the database to have the
correct on-disk data structures that the code is expecting. The entire
process is atomic, (i.e migration from 0-&gt;1 and 1-&gt;2 happen atomically).
This function is called before the module is initialized and as long as the
correct migrations are supplied in the migrations map, the module
will be able to read and write from the database successfully.</dd><dt><a class="fn" href="fn.apply_migrations_client_module_dbtx.html" title="fn fedimint_client::db::apply_migrations_client_module_dbtx">apply_<wbr>migrations_<wbr>client_<wbr>module_<wbr>dbtx</a></dt><dt><a class="fn" href="fn.apply_migrations_core_client_dbtx.html" title="fn fedimint_client::db::apply_migrations_core_client_dbtx">apply_<wbr>migrations_<wbr>core_<wbr>client_<wbr>dbtx</a></dt><dt><a class="fn" href="fn.get_active_states.html" title="fn fedimint_client::db::get_active_states">get_<wbr>active_<wbr>states</a></dt><dd>Reads all active states from the database and returns <code>Vec&lt;DynState&gt;</code>.
TODO: It is unfortunate that we canโt read states by the moduleโs instance
id so we are forced to return all active states. Once we do a db migration
to add <code>module_instance_id</code> to <code>ActiveStateKey</code>, this can be improved to
only read the moduleโs relevant states.</dd><dt><a class="fn" href="fn.get_core_client_database_migrations.html" title="fn fedimint_client::db::get_core_client_database_migrations">get_<wbr>core_<wbr>client_<wbr>database_<wbr>migrations</a></dt><dt><a class="fn" href="fn.get_decoded_client_secret.html" title="fn fedimint_client::db::get_decoded_client_secret">get_<wbr>decoded_<wbr>client_<wbr>secret</a></dt><dd>Fetches the encoded client secret from the database and decodes it.
If an encoded client secret is not present in the database, or if
decoding fails, an error is returned.</dd><dt><a class="fn" href="fn.get_inactive_states.html" title="fn fedimint_client::db::get_inactive_states">get_<wbr>inactive_<wbr>states</a></dt><dd>Reads all inactive states from the database and returns <code>Vec&lt;DynState&gt;</code>.
TODO: It is unfortunate that we canโt read states by the moduleโs instance
id so we are forced to return all inactive states. Once we do a db migration
to add <code>module_instance_id</code> to <code>InactiveStateKey</code>, this can be improved to
only read the moduleโs relevant states.</dd><dt><a class="fn" href="fn.remove_old_and_persist_new_active_states.html" title="fn fedimint_client::db::remove_old_and_persist_new_active_states">remove_<wbr>old_<wbr>and_<wbr>persist_<wbr>new_<wbr>active_<wbr>states</a></dt><dd>Persists new active states by first removing all current active states, and
re-writing with the new set of active states. <code>new_active_states</code> is
expected to contain all active states, not just the newly created states.</dd><dt><a class="fn" href="fn.remove_old_and_persist_new_inactive_states.html" title="fn fedimint_client::db::remove_old_and_persist_new_inactive_states">remove_<wbr>old_<wbr>and_<wbr>persist_<wbr>new_<wbr>inactive_<wbr>states</a></dt><dd>Persists new inactive states by first removing all current inactive states,
and re-writing with the new set of inactive states. <code>new_inactive_states</code> is
expected to contain all inactive states, not just the newly created states.</dd><dt><a class="fn" href="fn.verify_client_db_integrity_dbtx.html" title="fn fedimint_client::db::verify_client_db_integrity_dbtx">verify_<wbr>client_<wbr>db_<wbr>integrity_<wbr>dbtx</a><span title="Restricted Visibility">&nbsp;๐</span> </dt></dl></section></div></main></body></html>