<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Database keys used by the client"><title>fedimint_client::db - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="fedimint_client" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0-nightly (684b3553f 2024-06-20)" data-channel="nightly" data-search-js="search-0fe7219eb170c82e.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../fedimint_client/index.html">fedimint_client</a><span class="version">0.4.0-alpha</span></h2></div><h2 class="location"><a href="#">Module db</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Aliases</a></li></ul></section><h2><a href="../index.html">In crate fedimint_client</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">fedimint_client</a>::<wbr><a class="mod" href="#">db</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/fedimint_client/db.rs.html#1-689">source</a> ¬∑ <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Database keys used by the client</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ApiSecretKey.html" title="struct fedimint_client::db::ApiSecretKey">ApiSecretKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.ApiSecretKeyPrefix.html" title="struct fedimint_client::db::ApiSecretKeyPrefix">ApiSecretKeyPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.CachedApiVersionSet.html" title="struct fedimint_client::db::CachedApiVersionSet">CachedApiVersionSet</a></div></li><li><div class="item-name"><a class="struct" href="struct.CachedApiVersionSetKey.html" title="struct fedimint_client::db::CachedApiVersionSetKey">CachedApiVersionSetKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.ChronologicalOperationLogKey.html" title="struct fedimint_client::db::ChronologicalOperationLogKey">ChronologicalOperationLogKey</a></div><div class="desc docblock-short">Key used to lookup operation log entries in chronological order</div></li><li><div class="item-name"><a class="struct" href="struct.ChronologicalOperationLogKeyPrefix.html" title="struct fedimint_client::db::ChronologicalOperationLogKeyPrefix">ChronologicalOperationLogKeyPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientConfigKey.html" title="struct fedimint_client::db::ClientConfigKey">ClientConfigKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientConfigKeyPrefix.html" title="struct fedimint_client::db::ClientConfigKeyPrefix">ClientConfigKeyPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientInitStateKey.html" title="struct fedimint_client::db::ClientInitStateKey">ClientInitStateKey</a></div><div class="desc docblock-short">Does the client modules need to run recovery before being usable?</div></li><li><div class="item-name"><a class="struct" href="struct.ClientInitStatePrefix.html" title="struct fedimint_client::db::ClientInitStatePrefix">ClientInitStatePrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientMetadataKey.html" title="struct fedimint_client::db::ClientMetadataKey">ClientMetadataKey</a></div><div class="desc docblock-short">Client metadata that will be stored/restored on backup&amp;recovery</div></li><li><div class="item-name"><a class="struct" href="struct.ClientMetadataPrefix.html" title="struct fedimint_client::db::ClientMetadataPrefix">ClientMetadataPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientModuleRecovery.html" title="struct fedimint_client::db::ClientModuleRecovery">ClientModuleRecovery</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientModuleRecoveryPrefix.html" title="struct fedimint_client::db::ClientModuleRecoveryPrefix">ClientModuleRecoveryPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientModuleRecoveryState.html" title="struct fedimint_client::db::ClientModuleRecoveryState">ClientModuleRecoveryState</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientRecoverySnapshot.html" title="struct fedimint_client::db::ClientRecoverySnapshot">ClientRecoverySnapshot</a></div></li><li><div class="item-name"><a class="struct" href="struct.ClientRecoverySnapshotPrefix.html" title="struct fedimint_client::db::ClientRecoverySnapshotPrefix">ClientRecoverySnapshotPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.DbKeyPrefixIter.html" title="struct fedimint_client::db::DbKeyPrefixIter">DbKeyPrefixIter</a></div><div class="desc docblock-short">An iterator over the variants of <a href="enum.DbKeyPrefix.html" title="enum fedimint_client::db::DbKeyPrefix">DbKeyPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.EncodedClientSecretKey.html" title="struct fedimint_client::db::EncodedClientSecretKey">EncodedClientSecretKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.EncodedClientSecretKeyPrefix.html" title="struct fedimint_client::db::EncodedClientSecretKeyPrefix">EncodedClientSecretKeyPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.LastBackupKey.html" title="struct fedimint_client::db::LastBackupKey">LastBackupKey</a></div><div class="desc docblock-short">Last valid backup the client attempted to make</div></li><li><div class="item-name"><a class="struct" href="struct.MetaFieldKey.html" title="struct fedimint_client::db::MetaFieldKey">MetaFieldKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.MetaFieldPrefix.html" title="struct fedimint_client::db::MetaFieldPrefix">MetaFieldPrefix</a></div></li><li><div class="item-name"><a class="struct" href="struct.MetaFieldValue.html" title="struct fedimint_client::db::MetaFieldValue">MetaFieldValue</a></div></li><li><div class="item-name"><a class="struct" href="struct.MetaServiceInfo.html" title="struct fedimint_client::db::MetaServiceInfo">MetaServiceInfo</a></div></li><li><div class="item-name"><a class="struct" href="struct.MetaServiceInfoKey.html" title="struct fedimint_client::db::MetaServiceInfoKey">MetaServiceInfoKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.OperationLogKey.html" title="struct fedimint_client::db::OperationLogKey">OperationLogKey</a></div></li><li><div class="item-name"><a class="struct" href="struct.PeerLastApiVersionsSummary.html" title="struct fedimint_client::db::PeerLastApiVersionsSummary">PeerLastApiVersionsSummary</a></div></li><li><div class="item-name"><a class="struct" href="struct.PeerLastApiVersionsSummaryKey.html" title="struct fedimint_client::db::PeerLastApiVersionsSummaryKey">PeerLastApiVersionsSummaryKey</a></div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.DbKeyPrefix.html" title="enum fedimint_client::db::DbKeyPrefix">DbKeyPrefix</a></div></li><li><div class="item-name"><a class="enum" href="enum.InitMode.html" title="enum fedimint_client::db::InitMode">InitMode</a></div><div class="desc docblock-short">Client initialization mode</div></li><li><div class="item-name"><a class="enum" href="enum.InitModeComplete.html" title="enum fedimint_client::db::InitModeComplete">InitModeComplete</a></div><div class="desc docblock-short">Like <code>InitMode</code>, but without no longer required data.</div></li><li><div class="item-name"><a class="enum" href="enum.InitState.html" title="enum fedimint_client::db::InitState">InitState</a></div><div class="desc docblock-short">The state of the client initialization</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.apply_migrations_client.html" title="fn fedimint_client::db::apply_migrations_client">apply_migrations_client</a></div><div class="desc docblock-short"><code>apply_migrations_client</code> iterates from the on disk database version for the
client module up to <code>target_db_version</code> and executes all of the migrations
that exist in the migrations map, including state machine migrations.
Each migration in the migrations map updates the database to have the
correct on-disk data structures that the code is expecting. The entire
process is atomic, (i.e migration from 0-&gt;1 and 1-&gt;2 happen atomically).
This function is called before the module is initialized and as long as the
correct migrations are supplied in the migrations map, the module
will be able to read and write from the database successfully.</div></li><li><div class="item-name"><a class="fn" href="fn.get_active_states.html" title="fn fedimint_client::db::get_active_states">get_active_states</a></div><div class="desc docblock-short">Reads all active states from the database and returns <code>Vec&lt;DynState&gt;</code>.
TODO: It is unfortunate that we can‚Äôt read states by the module‚Äôs instance
id so we are forced to return all active states. Once we do a db migration
to add <code>module_instance_id</code> to <code>ActiveStateKey</code>, this can be improved to
only read the module‚Äôs relevant states.</div></li><li><div class="item-name"><a class="fn" href="fn.get_inactive_states.html" title="fn fedimint_client::db::get_inactive_states">get_inactive_states</a></div><div class="desc docblock-short">Reads all inactive states from the database and returns <code>Vec&lt;DynState&gt;</code>.
TODO: It is unfortunate that we can‚Äôt read states by the module‚Äôs instance
id so we are forced to return all inactive states. Once we do a db migration
to add <code>module_instance_id</code> to <code>InactiveStateKey</code>, this can be improved to
only read the module‚Äôs relevant states.</div></li><li><div class="item-name"><a class="fn" href="fn.migrate_state.html" title="fn fedimint_client::db::migrate_state">migrate_state</a></div><div class="desc docblock-short">Migrates a particular state by looping over all active and inactive states.
If the <code>migrate</code> closure returns <code>None</code>, this state was not migrated and
should be added to the new state machine vectors.</div></li><li><div class="item-name"><a class="fn" href="fn.remove_old_and_persist_new_active_states.html" title="fn fedimint_client::db::remove_old_and_persist_new_active_states">remove_old_and_persist_new_active_states</a></div><div class="desc docblock-short">Persists new active states by first removing all current active states, and
re-writing with the new set of active states. <code>new_active_states</code> is
expected to contain all active states, not just the newly created states.</div></li><li><div class="item-name"><a class="fn" href="fn.remove_old_and_persist_new_inactive_states.html" title="fn fedimint_client::db::remove_old_and_persist_new_inactive_states">remove_old_and_persist_new_inactive_states</a></div><div class="desc docblock-short">Persists new inactive states by first removing all current inactive states,
and re-writing with the new set of inactive states. <code>new_inactive_states</code> is
expected to contain all inactive states, not just the newly created states.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.ClientMigrationFn.html" title="type fedimint_client::db::ClientMigrationFn">ClientMigrationFn</a></div><div class="desc docblock-short"><code>ClientMigrationFn</code> is a function that modules can implement to ‚Äúmigrate‚Äù
the database to the next database version.</div></li><li><div class="item-name"><a class="type" href="type.MigrateStateFn.html" title="type fedimint_client::db::MigrateStateFn">MigrateStateFn</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">Helper function definition for migrating a single state.</div></li></ul></section></div></main></body></html>